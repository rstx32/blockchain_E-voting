<!-- Content Row -->
<div class="row">

    <% recap.forEach(r => { %>
        <div class="col-lg mb">
            <!-- Illustrations -->
            <div class="card shadow mb">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary"><%= r.candidate %> </h6>
                </div>
                <div class="card-body">
                    <div class="text-center">
                        <img class="img-fluid px-3 px-sm-4 mt-3 mb-4" style="width: 25rem;" src="http://localhost/photo/candidates/<%= r.photo %>" alt="...">
                    </div>
                    <div class="text-center">
                        <h3>Count : <%= r.count %> </h3>
                    </div>
                </div>
            </div>
        </div>
    <% }) %>

</div>

<div class="row" style="margin-top: 25px;">
    <!-- Donut Chart -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Donut Chart</h6>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-pie pt-4">
                    <canvas id="myPieChart"></canvas>
                </div>
                <hr>
                Pemenang sementara adalah <code><div id="winner">x</div></code>
            </div>
        </div>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>

<script>
    // Set new default font family and font color to mimic Bootstrap's default styling
    Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
    Chart.defaults.global.defaultFontColor = '#858796';

    function getRandomColor() {
        var letters = '0123456789ABCDEF'.split('');
        var color = '#';
        for (var i = 0; i < 6; i++ ) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }
    
    var objectOfRecap = <%- JSON.stringify(recap)%>

    var color = []
    for (let index = 0; index < objectOfRecap.length; index++) {
        color[index] = getRandomColor();
    }

    // Pie Chart Example
    var candidate = objectOfRecap.map(c => c.candidate)
    var count = objectOfRecap.map(c => c.count)
    var ctx = document.getElementById("myPieChart");
    var myPieChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: candidate,
            datasets: [{
                data: count,
                backgroundColor: color,
                hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
                hoverBorderColor: "rgba(234, 236, 244, 1)",
            }],
        },
        options: {
            maintainAspectRatio: false,
            tooltips: {
                backgroundColor: "rgb(255,255,255)",
                bodyFontColor: "#858796",
                borderColor: '#dddfeb',
                borderWidth: 1,
                xPadding: 15,
                yPadding: 15,
                displayColors: false,
                caretPadding: 10,
            },
            legend: {
                display: false  
            },
            cutoutPercentage: 80,
            hoverOffset: 4,
        },
    });

    let maxObj = objectOfRecap.reduce((max, obj) => (max.count > obj.count) ? max : obj);
    document.getElementById('winner').innerHTML = maxObj.candidate    
</script>